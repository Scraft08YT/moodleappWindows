<div class="settings-page">
    <header class="settings-page__header">
        <h1>Einstellungen</h1>
    </header>

    <div class="settings-page__body scroll-area">
        <!-- Theme -->
        <section class="settings-section card">
            <h3>Erscheinungsbild</h3>
            <p class="text-muted">Wähle das Farbschema der Anwendung.</p>
            <div class="theme-options">
                @for (option of themeOptions; track option.value) {
                <button class="theme-option" [class.theme-option--active]="theme() === option.value" (click)="setTheme(option.value)">
                    <span class="theme-option__icon">{{ option.icon }}</span>
                    <span class="theme-option__label">{{ option.label }}</span>
                    @if (theme() === option.value) {
                    <svg class="theme-option__check" viewBox="0 0 16 16" width="16" height="16" fill="currentColor">
                        <path
                            d="M13.86 3.66a.5.5 0 01.02.7l-7.5 8a.5.5 0 01-.73.01l-3.5-3.5a.5.5 0 01.7-.7L6.1 11.4l7.12-7.58a.5.5 0 01.64-.16z" />
                    </svg>
                    }
                </button>
                }
            </div>
        </section>

        <!-- Account -->
        @if (session()) {
        <section class="settings-section card">
            <h3>Konto</h3>
            <div class="account-info">
                <div class="account-info__row">
                    <span class="account-info__label">Name</span>
                    <span class="account-info__value">{{ userName }}</span>
                </div>
                <div class="account-info__row">
                    <span class="account-info__label">E-Mail</span>
                    <span class="account-info__value">{{ userEmail }}</span>
                </div>
                <div class="account-info__row">
                    <span class="account-info__label">Website</span>
                    <span class="account-info__value">{{ siteUrl }}</span>
                </div>
            </div>
        </section>
        }

        <!-- Storage -->
        <section class="settings-section card">
            <h3>Speicher</h3>
            <p class="text-muted">Lösche den lokalen Cache, um Speicherplatz freizugeben.</p>
            <div class="storage-actions">
                <button class="btn-primary" (click)="clearCache()">
                    @if (cacheCleared()) {
                    ✅ Cache geleert
                    } @else {
                    Cache leeren
                    }
                </button>
            </div>
        </section>

        <!-- About & Update -->
        <section class="settings-section card">
            <h3>Über & Updates</h3>
            <div class="about-info">
                <div class="about-info__row">
                    <span class="about-info__label">Version</span>
                    <span class="about-info__value">{{ appVersion() }}</span>
                </div>
                <div class="about-info__row">
                    <span class="about-info__label">Technologie</span>
                    <span class="about-info__value">Tauri v2 + Angular 19</span>
                </div>
                <div class="about-info__row">
                    <span class="about-info__label">Plattform</span>
                    <span class="about-info__value">Windows (WebView2)</span>
                </div>
            </div>

            <div class="update-section">
                @if (updateService.status() === 'idle' || updateService.status() === 'up-to-date' || updateService.status() === 'error') {
                <button class="btn-outline" (click)="checkForUpdate()" [disabled]="updateService.status() === 'checking'">
                    <svg viewBox="0 0 20 20" width="16" height="16" fill="currentColor">
                        <path
                            d="M10 2a8 8 0 11-4.9 14.32.5.5 0 01.61-.79A7 7 0 1010 3a6.97 6.97 0 00-5.26 2.39L6.5 7H3a.5.5 0 01-.5-.5V3l1.8 1.8A8 8 0 0110 2z" />
                    </svg>
                    Nach Updates suchen
                </button>
                }

                @if (updateService.status() === 'checking') {
                <div class="update-status">
                    <span class="spinner spinner--sm"></span>
                    <span class="text-muted">Suche nach Updates…</span>
                </div>
                }

                @if (updateService.status() === 'up-to-date') {
                <div class="update-status update-status--success">
                    <svg viewBox="0 0 16 16" width="16" height="16" fill="currentColor">
                        <path
                            d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z" />
                    </svg>
                    <span>App ist aktuell</span>
                </div>
                }

                @if (updateService.status() === 'error') {
                <div class="update-status update-status--error">
                    <svg viewBox="0 0 20 20" width="14" height="14" fill="currentColor">
                        <path
                            d="M10 2a8 8 0 100 16 8 8 0 000-16zm-.75 4.75a.75.75 0 011.5 0v4.5a.75.75 0 01-1.5 0v-4.5zM10 14a1 1 0 100-2 1 1 0 000 2z" />
                    </svg>
                    <span>{{ updateService.errorMessage() }}</span>
                </div>
                }

                @if (updateService.status() === 'available') {
                <div class="update-available card">
                    <div class="update-available__header">
                        <div class="update-available__badge">
                            <svg viewBox="0 0 20 20" width="14" height="14" fill="currentColor">
                                <path
                                    d="M10 2.5a.5.5 0 01.5.5v6.5H17a.5.5 0 010 1h-6.5V17a.5.5 0 01-1 0v-6.5H3a.5.5 0 010-1h6.5V3a.5.5 0 01.5-.5z" />
                            </svg>
                            Neue Version verfügbar
                        </div>
                        <span class="update-available__version">v{{ updateService.updateInfo()?.version }}</span>
                    </div>
                    @if (updateService.updateInfo()?.body) {
                    <p class="update-available__notes text-muted">{{ updateService.updateInfo()?.body }}</p>
                    }
                    <button class="btn-primary" (click)="installUpdate()">
                        <svg viewBox="0 0 20 20" width="14" height="14" fill="currentColor">
                            <path
                                d="M10 2a.5.5 0 01.5.5v8.8l2.65-2.65a.5.5 0 01.7.7l-3.5 3.5a.5.5 0 01-.7 0l-3.5-3.5a.5.5 0 01.7-.7l2.65 2.64V2.5A.5.5 0 0110 2zM3.5 14a.5.5 0 00-.5.5v1A1.5 1.5 0 004.5 17h11a1.5 1.5 0 001.5-1.5v-1a.5.5 0 00-1 0v1a.5.5 0 01-.5.5h-11a.5.5 0 01-.5-.5v-1a.5.5 0 00-.5-.5z" />
                        </svg>
                        Jetzt aktualisieren
                    </button>
                </div>
                }

                @if (updateService.status() === 'downloading') {
                <div class="update-progress">
                    <div class="update-progress__bar">
                        <div class="update-progress__fill" [style.width.%]="updateService.downloadProgress()"></div>
                    </div>
                    <span class="text-muted">Update wird heruntergeladen… {{ updateService.downloadProgress() }}%</span>
                </div>
                }

                @if (updateService.status() === 'ready') {
                <div class="update-status update-status--success">
                    <svg viewBox="0 0 16 16" width="16" height="16" fill="currentColor">
                        <path
                            d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z" />
                    </svg>
                    <span>Update installiert – App wird neu gestartet…</span>
                </div>
                }
            </div>
        </section>

        <!-- Logout -->
        <section class="settings-section">
            <button class="btn-danger" (click)="logout()">
                <svg viewBox="0 0 16 16" width="16" height="16" fill="currentColor">
                    <path
                        d="M11.5 3a.5.5 0 010 1H3v8h8.5a.5.5 0 010 1H2.5a.5.5 0 01-.5-.5v-9a.5.5 0 01.5-.5h9zm1.354 2.146a.5.5 0 010 .708L11.207 7.5H15a.5.5 0 010 1h-3.793l1.647 1.646a.5.5 0 01-.708.708l-2.5-2.5a.5.5 0 010-.708l2.5-2.5a.5.5 0 01.708 0z" />
                </svg>
                Abmelden
            </button>
        </section>
    </div>
</div>
