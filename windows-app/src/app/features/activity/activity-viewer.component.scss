@use 'variables' as *;

.activity-page {
    padding: 24px;
    max-width: 860px;
    animation: fadeIn 200ms ease-out;

    &__back {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        color: var(--fg-2);
        text-decoration: none;
        font-size: 13px;
        padding: 4px 0;
        margin-bottom: 8px;
        cursor: pointer;
        background: none;
        border: none;

        &:hover { color: var(--accent); }
    }

    &__title {
        font-size: 22px;
        font-weight: 600;
        color: var(--fg-1);
        margin: 0 0 20px;
    }

    &__skeleton {
        padding: 24px;
    }

    &__error {
        padding: 24px;
        color: var(--danger);
    }
}

/* ============ Forum ============ */
.forum-view {
    display: flex;
    flex-direction: column;
    gap: 12px;
}

.forum-intro {
    padding: 16px 20px;
    font-size: 14px;
    line-height: 1.6;
    color: var(--fg-2);
}

.forum-error {
    padding: 12px 16px;
    font-size: 13px;
    color: var(--status-overdue, #d32f2f);
    background: rgba(211, 47, 47, 0.08);
    border: 1px solid rgba(211, 47, 47, 0.2);
    border-radius: 8px;
}

.forum-actions {
    display: flex;
    gap: 8px;
}

.new-discussion {
    display: flex;
    flex-direction: column;
    gap: 12px;
    padding: 20px;

    h3 {
        margin: 0;
        font-size: 16px;
        font-weight: 600;
    }
}

.discussion-list {
    display: flex;
    flex-direction: column;
    gap: 4px;
}

.discussion-item {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 12px 16px;
    background: none;
    border: none;
    cursor: pointer;
    text-align: left;
    width: 100%;
    transition: background 120ms ease;

    &:hover { background: var(--hover); }

    &__avatar {
        width: 36px;
        height: 36px;
        border-radius: 50%;
        overflow: hidden;
        flex-shrink: 0;
        background: var(--bg-3);

        img { width: 100%; height: 100%; object-fit: cover; }
    }

    &__info {
        flex: 1;
        display: flex;
        flex-direction: column;
        min-width: 0;
    }

    &__name {
        font-size: 14px;
        font-weight: 500;
        color: var(--fg-1);
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
    }

    &__meta {
        font-size: 12px;
        margin-top: 2px;
    }

    &__chevron {
        flex-shrink: 0;
        color: var(--fg-3);
    }
}

/* ============ Posts ============ */
.post-list {
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.post {
    padding: 16px 20px;

    &__header {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-bottom: 8px;
    }

    &__avatar {
        width: 32px;
        height: 32px;
        border-radius: 50%;
        overflow: hidden;
        background: var(--bg-3);

        img { width: 100%; height: 100%; object-fit: cover; }
    }

    &__author {
        font-size: 14px;
        font-weight: 500;
        color: var(--fg-1);
    }

    &__time {
        font-size: 12px;
    }

    &__subject {
        font-size: 15px;
        font-weight: 600;
        color: var(--fg-1);
        margin-bottom: 8px;
    }

    &__body {
        font-size: 14px;
        line-height: 1.6;
        color: var(--fg-2);

        img { max-width: 100%; border-radius: 4px; }
        a { color: var(--accent); }
    }

    &__attachments {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        margin-top: 12px;
    }

    &__attachment {
        font-size: 13px;
        color: var(--accent);
        text-decoration: none;

        &:hover { text-decoration: underline; }
    }

    &__actions {
        display: flex;
        gap: 4px;
        margin-top: 8px;
    }

    &__action--danger {
        color: var(--status-overdue, #d32f2f) !important;

        &:hover { background: rgba(211, 47, 47, 0.08); }
    }

    &__edit-form {
        display: flex;
        flex-direction: column;
        gap: 8px;
        margin-top: 8px;
        padding: 12px;
        border-radius: 8px;
        background: var(--bg-2);
        animation: fadeIn 150ms ease;
    }

    &__edit-actions {
        display: flex;
        gap: 8px;
        justify-content: flex-end;
    }

    &__reply-form {
        display: flex;
        flex-direction: column;
        gap: 8px;
        margin-top: 12px;
        padding: 12px;
        border-radius: 8px;
        background: var(--bg-2);
    }

    &__reply-actions {
        display: flex;
        gap: 8px;
        justify-content: flex-end;
    }
}

/* ============ Assignment ============ */
:host {
    --status-submitted: #2e7d32;
    --status-draft: #ed6c02;
    --status-new: #757575;
    --status-overdue: #d32f2f;
    --status-graded: #1565c0;
    --grade-text: #1565c0;
    --grade-bg: rgba(21, 101, 192, 0.08);
}

:host-context([data-theme="dark"]) {
    --status-submitted: #66bb6a;
    --status-draft: #ffa726;
    --status-new: #bdbdbd;
    --status-overdue: #ef5350;
    --status-graded: #42a5f5;
    --grade-text: #64b5f6;
    --grade-bg: rgba(100, 181, 246, 0.12);
}

.assign-view {
    display: flex;
    flex-direction: column;
    gap: 12px;
}

/* Hero header */
.assign-hero {
    background: var(--bg-2);
    border-radius: 8px;
    border-left: 4px solid var(--accent);
    padding: 20px 24px;
    animation: fadeIn 200ms ease;

    &__top {
        display: flex;
        gap: 8px;
        align-items: center;
        flex-wrap: wrap;
        margin-bottom: 12px;
    }

    &__intro {
        font-size: 14px;
        line-height: 1.6;
        color: var(--fg-2);
        img { max-width: 100%; }
    }
}

.assign-badge {
    display: inline-flex;
    align-items: center;
    gap: 4px;
    padding: 4px 12px;
    border-radius: 20px;
    font-size: 13px;
    font-weight: 600;
    color: #fff;
    letter-spacing: 0.02em;

    &--overdue {
        background: var(--status-overdue) !important;
    }
}

.assign-section-title {
    margin: 0 0 14px;
    font-size: 15px;
    font-weight: 600;
    color: var(--fg-1);
}

/* Timeline */
.assign-timeline {
    padding: 20px 24px;

    &__items {
        display: flex;
        flex-direction: column;
        gap: 0;
        position: relative;
        padding-left: 18px;

        &::before {
            content: '';
            position: absolute;
            left: 5px;
            top: 6px;
            bottom: 6px;
            width: 2px;
            background: var(--border);
            border-radius: 1px;
        }
    }

    &__item {
        position: relative;
        padding: 8px 0 8px 16px;

        &--warn .assign-timeline__value {
            color: var(--status-overdue);
            font-weight: 600;
        }
    }

    &__dot {
        position: absolute;
        left: -18px;
        top: 12px;
        width: 12px;
        height: 12px;
        border-radius: 50%;
        background: var(--bg-2);
        border: 2px solid var(--border);
        z-index: 1;

        &--start { border-color: var(--status-submitted); background: var(--status-submitted); }
        &--due { border-color: var(--accent); background: var(--accent); }
        &--overdue { border-color: var(--status-overdue); background: var(--status-overdue); }
        &--end { border-color: var(--fg-3); background: var(--fg-3); }
    }

    &__content {
        display: flex;
        flex-direction: column;
        gap: 2px;
    }

    &__label {
        font-size: 12px;
        font-weight: 500;
        color: var(--fg-3);
        text-transform: uppercase;
        letter-spacing: 0.04em;
    }

    &__value {
        font-size: 14px;
        color: var(--fg-1);
        font-weight: 500;
    }

    &__remaining {
        font-size: 12px;
        color: var(--fg-3);
        font-style: italic;

        &--warn {
            color: var(--status-overdue);
            font-weight: 600;
            font-style: normal;
        }
    }
}

/* Status card */
.assign-status {
    padding: 20px 24px;
    border-left: 4px solid var(--accent);

    &__table {
        display: flex;
        flex-direction: column;
        gap: 0;
    }

    &__row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 10px 0;
        border-bottom: 1px solid var(--border);

        &:last-child { border-bottom: none; }
    }

    &__label {
        font-size: 13px;
        color: var(--fg-3);
        font-weight: 500;
    }

    &__value {
        font-size: 14px;
        color: var(--fg-1);
        font-weight: 500;
        text-align: right;
    }
}

/* Existing file list */
.assign-files {
    margin-top: 16px;
    padding-top: 16px;
    border-top: 1px solid var(--border);

    &__title {
        font-size: 14px;
        font-weight: 600;
        margin: 0 0 8px;
        color: var(--fg-2);
    }

    &__item {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 8px 10px;
        border-radius: 6px;
        transition: background 120ms ease;

        &:hover { background: var(--hover); }
    }

    &__name {
        flex: 1;
        font-size: 13px;
        color: var(--fg-1);
    }

    &__size {
        font-size: 12px;
        flex-shrink: 0;
    }
}

/* Grade card */
.assign-grade {
    padding: 20px 24px;
    border-left: 4px solid var(--status-graded);

    &__display {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 16px;
        padding: 20px 16px;
        background: var(--grade-bg);
        border-radius: 10px;
        margin-bottom: 12px;
    }

    &__value {
        font-size: 28px;
        font-weight: 700;
        color: var(--grade-text);
    }

    &__points {
        font-size: 16px;
        font-weight: 600;
        color: var(--fg-2);
        font-variant-numeric: tabular-nums;
    }

    &__slider {
        width: 100%;
        max-width: 320px;
    }

    &__track {
        position: relative;
        width: 100%;
        height: 8px;
        background: var(--bg-hover);
        border-radius: 4px;
        overflow: hidden;
    }

    &__fill {
        position: absolute;
        inset: 0;
        border-radius: 4px;
        transition: width 600ms cubic-bezier(0.22, 1, 0.36, 1);

        &--excellent { background: linear-gradient(90deg, #43a047, #66bb6a); }
        &--good     { background: linear-gradient(90deg, #fb8c00, #ffa726); }
        &--fair     { background: linear-gradient(90deg, #f4511e, #ff7043); }
        &--poor     { background: linear-gradient(90deg, #e53935, #ef5350); }
    }

    &__labels {
        display: flex;
        justify-content: space-between;
        margin-top: 6px;
        font-size: 11px;
        color: var(--fg-3);
        font-variant-numeric: tabular-nums;
    }

    &__pct {
        font-size: 13px;
        font-weight: 600;
        color: var(--fg-2);
        text-align: center;
        margin-top: 2px;
    }

    &__feedback {
        font-size: 14px;
        line-height: 1.6;
        color: var(--fg-2);
    }

    &__comment {
        padding: 12px;
        background: var(--bg-hover);
        border-radius: 6px;

        a { color: var(--accent); }
    }
}

/* Submission area */
.assign-submit {
    padding: 20px 24px;

    &__toggle {
        display: flex;
        width: 100%;
        align-items: center;
        justify-content: center;
        gap: 8px;
        padding: 14px 20px;
        border: 2px dashed var(--accent);
        border-radius: 8px;
        background: transparent;
        color: var(--accent);
        font-size: 15px;
        font-weight: 600;
        cursor: pointer;
        transition: all 150ms ease;

        &:hover {
            background: rgba(0, 120, 212, 0.06);
            border-style: solid;
        }
    }
}

/* Editor panel */
.assign-editor {
    animation: fadeIn 200ms ease;

    &__header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 16px;

        .assign-section-title { margin: 0; }
    }

    &__label {
        display: block;
        font-size: 13px;
        font-weight: 600;
        color: var(--fg-2);
        margin-bottom: 6px;
    }

    &__text {
        margin-bottom: 16px;
    }

    &__files {
        margin-bottom: 16px;
    }

    &__progress {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 10px 14px;
        background: rgba(0, 120, 212, 0.06);
        border-radius: 6px;
        font-size: 13px;
        color: var(--accent);
        margin-bottom: 12px;
    }

    &__spinner {
        width: 16px;
        height: 16px;
        border: 2px solid var(--border);
        border-top-color: var(--accent);
        border-radius: 50%;
        animation: spin 700ms linear infinite;
    }

    &__actions {
        display: flex;
        gap: 10px;
        justify-content: flex-end;
        padding-top: 12px;
        border-top: 1px solid var(--border);
    }
}

/* Dropzone */
.assign-dropzone {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 8px;
    padding: 28px 20px;
    border: 2px dashed var(--border);
    border-radius: 8px;
    background: var(--bg-1);
    cursor: pointer;
    transition: all 150ms ease;
    color: var(--fg-3);
    font-size: 13px;

    &:hover {
        border-color: var(--accent);
        background: rgba(0, 120, 212, 0.04);
        color: var(--accent);
    }
}

/* Pending files */
.assign-pending {
    display: flex;
    flex-direction: column;
    gap: 4px;
    margin-top: 10px;

    &__item {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 6px 10px;
        border-radius: 6px;
        background: var(--hover);
        animation: fadeIn 150ms ease;
    }

    &__name {
        flex: 1;
        font-size: 13px;
        color: var(--fg-1);
    }

    &__size {
        font-size: 12px;
    }

    &__remove {
        padding: 2px 6px !important;
        font-size: 14px;
        color: var(--fg-3) !important;

        &:hover { color: var(--status-overdue) !important; }
    }
}

/* Messages */
.assign-msg {
    margin-top: 12px;
    padding: 10px 14px;
    border-radius: 6px;
    font-size: 13px;
    font-weight: 500;
    animation: fadeIn 200ms ease;

    &--success {
        background: rgba(46, 125, 50, 0.08);
        color: var(--status-submitted);
        border: 1px solid rgba(46, 125, 50, 0.2);
    }

    &--error {
        background: rgba(211, 47, 47, 0.08);
        color: var(--status-overdue);
        border: 1px solid rgba(211, 47, 47, 0.2);
    }
}

@keyframes spin {
    to { transform: rotate(360deg); }
}

/* ============ Page / Book ============ */
.page-view {
    padding: 24px;
}

.page-content {
    font-size: 14px;
    line-height: 1.7;
    color: var(--fg-2);

    img { max-width: 100%; border-radius: 4px; }
    a { color: var(--accent); }
    h1, h2, h3, h4 { color: var(--fg-1); margin: 16px 0 8px; }
    table { border-collapse: collapse; width: 100%; margin: 12px 0; }
    td, th { padding: 6px 10px; border: 1px solid var(--border); }
}

/* ============ URL ============ */
.url-view {
    padding: 24px;
}

.url-description {
    font-size: 14px;
    line-height: 1.6;
    color: var(--fg-2);
    margin-bottom: 16px;
}

.url-action {
    display: flex;
    flex-direction: column;
    gap: 8px;
}

/* ============ Resource ============ */
.resource-view {
    padding: 24px;
}

.resource-description {
    font-size: 14px;
    line-height: 1.6;
    color: var(--fg-2);
    margin-bottom: 16px;
}

.resource-file {
    display: flex;
    align-items: center;
    gap: 12px;

    &__name {
        font-size: 14px;
        color: var(--fg-1);
        font-weight: 500;
    }
}

/* ============ Folder ============ */
.folder-view {
    padding: 24px;
}

.folder-description {
    font-size: 14px;
    line-height: 1.6;
    color: var(--fg-2);
    margin-bottom: 16px;
}

.folder-files {
    display: flex;
    flex-direction: column;
    gap: 2px;
}

.folder-file {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 8px 12px;
    border-radius: 6px;
    transition: background 120ms ease;

    &:hover { background: var(--hover); }

    &__name {
        flex: 1;
        font-size: 14px;
        color: var(--fg-1);
    }

    &__size {
        font-size: 12px;
        flex-shrink: 0;
    }
}

/* ============ Assignment Comments ============ */
.assign-comments {
    padding: 0;
    overflow: hidden;

    &__toggle {
        display: flex;
        align-items: center;
        gap: 8px;
        width: 100%;
        padding: 14px 20px;
        background: none;
        border: none;
        cursor: pointer;
        font-size: 14px;
        font-weight: 500;
        color: var(--fg-1);
        text-align: left;

        &:hover { background: var(--hover); }
    }

    &__count {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        min-width: 20px;
        height: 20px;
        padding: 0 6px;
        border-radius: 10px;
        background: var(--accent);
        color: #fff;
        font-size: 11px;
        font-weight: 600;
    }

    &__chevron {
        margin-left: auto;
        transition: transform 200ms ease;

        &--open { transform: rotate(180deg); }
    }

    &__body {
        padding: 0 20px 16px;
        display: flex;
        flex-direction: column;
        gap: 10px;
        animation: fadeIn 150ms ease;
    }

    &__item {
        padding: 10px 12px;
        border-radius: 6px;
        background: var(--bg-2);
    }

    &__meta {
        display: flex;
        gap: 8px;
        align-items: baseline;
        margin-bottom: 4px;
    }

    &__author {
        font-size: 13px;
        font-weight: 500;
        color: var(--fg-1);
    }

    &__time {
        font-size: 11px;
    }

    &__content {
        font-size: 13px;
        line-height: 1.5;
        color: var(--fg-2);
    }

    &__form {
        display: flex;
        gap: 8px;
        align-items: flex-end;

        textarea { flex: 1; }
    }
}

/* ============ Quiz ============ */
.quiz-view {
    display: flex;
    flex-direction: column;
    gap: 12px;
}

.quiz-error {
    padding: 12px 16px;
    font-size: 13px;
    color: var(--status-overdue, #d32f2f);
    background: rgba(211, 47, 47, 0.08);
    border: 1px solid rgba(211, 47, 47, 0.2);
    border-radius: 8px;
}

.quiz-intro {
    padding: 16px 20px;
    font-size: 14px;
    line-height: 1.6;
    color: var(--fg-2);
}

.quiz-section-title {
    margin: 0 0 14px;
    font-size: 15px;
    font-weight: 600;
    color: var(--fg-1);
}

.quiz-details {
    padding: 20px 24px;

    &__table {
        display: flex;
        flex-direction: column;
        gap: 2px;
    }

    &__row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 8px 0;
        border-bottom: 1px solid var(--border);

        &:last-child { border-bottom: none; }
    }

    &__label {
        font-size: 13px;
        color: var(--fg-3);
    }

    &__value {
        font-size: 14px;
        font-weight: 500;
        color: var(--fg-1);
    }
}

.quiz-grade {
    padding: 20px 24px;

    &__value {
        font-size: 20px;
        font-weight: 700;
        color: var(--grade-text, var(--accent));
    }
}

/* Attempts table */
.quiz-attempts {
    padding: 20px 24px;

    &__table {
        display: flex;
        flex-direction: column;
        gap: 0;
    }

    &__header {
        display: flex;
        gap: 8px;
        padding: 8px 0;
        border-bottom: 2px solid var(--border);
        font-size: 12px;
        font-weight: 600;
        color: var(--fg-3);
        text-transform: uppercase;
        letter-spacing: 0.04em;
    }

    &__row {
        display: flex;
        gap: 8px;
        padding: 10px 0;
        border-bottom: 1px solid var(--border);
        align-items: center;

        &:last-child { border-bottom: none; }
        &--active { background: rgba(var(--accent-rgb, 0, 120, 212), 0.06); border-radius: 6px; padding: 10px 8px; }
    }

    &__col {
        min-width: 50px;
        font-size: 13px;
        color: var(--fg-1);

        &--grow { flex: 1; }
    }

    &__state {
        display: inline-block;
        padding: 2px 8px;
        border-radius: 10px;
        font-size: 12px;
        font-weight: 500;

        &--progress {
            background: rgba(237, 108, 2, 0.12);
            color: var(--status-draft);
        }
        &--finished {
            background: rgba(46, 125, 50, 0.12);
            color: var(--status-submitted);
        }
    }
}

.quiz-actions {
    display: flex;
    gap: 8px;
    align-items: center;
}

.quiz-access-reasons {
    display: flex;
    flex-direction: column;
    gap: 4px;
}

/* Timer */
.quiz-timer {
    display: flex;
    align-items: center;
    gap: 6px;
    padding: 8px 16px;
    border-radius: 8px;
    background: var(--bg-2);
    font-size: 16px;
    font-weight: 600;
    color: var(--fg-1);
    position: sticky;
    top: 0;
    z-index: 10;

    &--warn {
        background: rgba(211, 47, 47, 0.12);
        color: var(--status-overdue);
        animation: pulse 1s ease infinite;
    }
}

@keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.7; }
}

.quiz-page-indicator {
    font-size: 13px;
    padding: 4px 0;
}

/* Question container — inherits Moodle's rendered HTML */
.quiz-questions {
    padding: 20px 24px;
    font-size: 14px;
    line-height: 1.6;

    // ── Unsupported question type notice ──
    ::ng-deep .unsupported-qtype-notice {
        padding: 10px 14px;
        margin-bottom: 12px;
        border-radius: 6px;
        background: rgba(237, 108, 2, 0.1);
        border: 1px solid rgba(237, 108, 2, 0.25);
        color: var(--fg-2);
        font-size: 13px;
    }

    // ── Moodle question wrapper (.que) ──
    ::ng-deep .que {
        margin-bottom: 24px;
        padding-bottom: 20px;
        border-bottom: 1px solid var(--border);

        &:last-child { border-bottom: none; margin-bottom: 0; padding-bottom: 0; }
    }

    // ── Question info sidebar (number, grade, flag) ──
    ::ng-deep .info {
        display: flex;
        flex-wrap: wrap;
        align-items: center;
        gap: 8px;
        margin-bottom: 10px;
        font-size: 12px;
        color: var(--fg-3);

        .questionflag {
            display: inline-flex;
            align-items: center;
            gap: 4px;

            // Moodle renders a form with a big image — tame it
            input[type="image"],
            img {
                width: 16px !important;
                height: 16px !important;
                vertical-align: middle;
                opacity: 0.6;
                cursor: pointer;
                transition: opacity 120ms;

                &:hover { opacity: 1; }
            }

            // Hide the legacy toggle label
            .questionflagtext { display: none; }
        }

        // State label
        .state {
            font-size: 12px;
            font-weight: 500;
            padding: 2px 8px;
            border-radius: 10px;
            background: var(--bg-2);
        }

        // Grade text
        .grade {
            font-size: 12px;
        }
    }

    // ── Content area ──
    ::ng-deep .content {
        padding: 0;
    }

    // ── Formulation (question body) ──
    ::ng-deep .formulation {
        margin-bottom: 16px;
        padding: 14px 16px;
        border-radius: 8px;
        background: var(--bg-2);
    }

    ::ng-deep .qtext {
        margin-bottom: 12px;
        font-weight: 500;
        color: var(--fg-1);

        p { margin: 4px 0; }
    }

    // ── Answer blocks ──
    ::ng-deep .ablock {
        margin-top: 8px;
    }

    // Multi-choice answer list
    ::ng-deep .answer {
        display: flex;
        flex-direction: column;
        gap: 6px;

        // Individual answer option (div wrapping label)
        > div {
            display: flex;
            align-items: flex-start;
            gap: 8px;
            padding: 8px 12px;
            border-radius: 6px;
            transition: background 120ms ease;

            &:hover { background: var(--hover); }

            // Correct/incorrect highlighting
            &.correct { background: rgba(46, 125, 50, 0.08); }
            &.incorrect { background: rgba(211, 47, 47, 0.06); }
        }

        label {
            display: flex;
            align-items: flex-start;
            gap: 8px;
            cursor: pointer;
            flex: 1;
            min-width: 0;
        }
    }

    // ── Matching question table ──
    ::ng-deep table {
        width: 100%;
        border-collapse: collapse;
        margin: 8px 0;
        font-size: 14px;

        th, td {
            padding: 8px 12px;
            text-align: left;
            border-bottom: 1px solid var(--border);
            color: var(--fg-1);
        }

        th {
            font-weight: 600;
            font-size: 12px;
            text-transform: uppercase;
            color: var(--fg-3);
            background: var(--bg-2);
        }

        tr:last-child td { border-bottom: none; }
        tr:hover td { background: var(--hover); }

        // Correct/incorrect row highlights
        tr.correct td { background: rgba(46, 125, 50, 0.06); }
        tr.incorrect td { background: rgba(211, 47, 47, 0.04); }
    }

    // ── Form controls ──
    ::ng-deep input[type="radio"],
    ::ng-deep input[type="checkbox"] {
        accent-color: var(--accent);
        width: 16px;
        height: 16px;
        flex-shrink: 0;
        margin-top: 2px;
    }

    ::ng-deep input[type="text"],
    ::ng-deep textarea {
        padding: 6px 10px;
        border: 1px solid var(--border);
        border-radius: 6px;
        background: var(--bg-1);
        color: var(--fg-1);
        font-size: 14px;
        font-family: inherit;
        outline: none;
        max-width: 100%;

        &:focus { border-color: var(--accent); }
    }

    ::ng-deep select {
        appearance: auto;
        padding: 6px 10px;
        border: 1px solid var(--border);
        border-radius: 6px;
        background: var(--bg-1);
        color: var(--fg-1);
        font-size: 14px;
        font-family: inherit;
        outline: none;
        cursor: pointer;
        max-width: 280px;

        &:focus { border-color: var(--accent); }
    }

    // ── Feedback areas ──
    ::ng-deep .outcome {
        margin-top: 12px;
    }

    ::ng-deep .feedback,
    ::ng-deep .specificfeedback {
        margin-top: 8px;
        padding: 10px 14px;
        border-radius: 6px;
        background: var(--bg-2);
        font-size: 13px;
        color: var(--fg-2);
    }

    ::ng-deep .generalfeedback {
        margin-top: 8px;
        padding: 10px 14px;
        border-radius: 6px;
        background: rgba(0, 120, 212, 0.06);
        font-size: 13px;
        color: var(--fg-2);
    }

    ::ng-deep .rightanswer {
        margin-top: 8px;
        padding: 10px 14px;
        border-radius: 6px;
        background: rgba(46, 125, 50, 0.06);
        font-size: 13px;
        color: var(--fg-2);
    }

    ::ng-deep .numpartscorrect {
        margin-top: 6px;
        font-size: 13px;
        color: var(--fg-3);
    }

    // ── Correct/incorrect markers ──
    ::ng-deep .correct { color: var(--status-submitted); }
    ::ng-deep .incorrect { color: var(--status-overdue); }
    ::ng-deep .partiallycorrect { color: var(--status-draft); }

    ::ng-deep .correctness {
        display: inline-block;
        font-size: 12px;
        font-weight: 500;
        padding: 2px 8px;
        border-radius: 10px;
        margin-left: 6px;
        vertical-align: middle;

        &.correct {
            background: rgba(46, 125, 50, 0.12);
            color: var(--status-submitted);
        }
        &.incorrect {
            background: rgba(211, 47, 47, 0.1);
            color: var(--status-overdue);
        }
        &.partiallycorrect {
            background: rgba(237, 108, 2, 0.1);
            color: var(--status-draft);
        }
    }

    // Tick/cross icons next to answers
    ::ng-deep .icon.fa-check,
    ::ng-deep .icon.fa-times,
    ::ng-deep .fa-check,
    ::ng-deep .fa-times,
    ::ng-deep .fa-remove {
        font-size: 14px;
        margin-left: 4px;
    }

    // ── Global flag image catch-all (may sit outside .info) ──
    ::ng-deep .questionflagimage,
    ::ng-deep .questionflag input[type="image"],
    ::ng-deep .questionflag img {
        width: 16px !important;
        height: 16px !important;
        vertical-align: middle;
        opacity: 0.6;
        border-radius: 0 !important;
    }

    // ── Images ──
    ::ng-deep img {
        max-width: 100%;
        border-radius: 4px;
        height: auto;
    }

    // ── Drag & drop / sortable placeholders ──
    ::ng-deep .draghome,
    ::ng-deep .droptarget,
    ::ng-deep .drop,
    ::ng-deep .place {
        display: inline-block;
        padding: 4px 10px;
        border: 1px dashed var(--border);
        border-radius: 4px;
        background: var(--bg-2);
        min-width: 60px;
        min-height: 28px;
        vertical-align: middle;
    }

    // ── Hidden elements Moodle includes ──
    ::ng-deep .validationerror {
        color: var(--status-overdue);
        font-size: 13px;
        margin-top: 4px;
    }

    ::ng-deep .accesshide,
    ::ng-deep .sr-only {
        position: absolute !important;
        width: 1px !important;
        height: 1px !important;
        overflow: hidden !important;
        clip: rect(0, 0, 0, 0) !important;
        white-space: nowrap !important;
    }

    // Links
    ::ng-deep a {
        color: var(--accent);
        text-decoration: none;

        &:hover { text-decoration: underline; }
    }

    // Moodle buttons (rendered as <input type="submit">)
    ::ng-deep input[type="submit"],
    ::ng-deep button:not(.btn-primary:not(.btn-secondary):not(.btn-subtle)) {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 6px 14px;
        border: 1px solid var(--border);
        border-radius: 6px;
        background: var(--bg-2);
        color: var(--fg-1);
        font-size: 13px;
        font-family: inherit;
        cursor: pointer;
        transition: background 120ms ease;

        &:hover { background: var(--hover); }
    }
}

.quiz-nav {
    display: flex;
    gap: 8px;
    align-items: center;
    flex-wrap: wrap;
}

/* Summary */
.quiz-summary {
    padding: 20px 24px;

    &__table {
        display: flex;
        flex-direction: column;
        margin-bottom: 16px;
    }

    &__header {
        display: flex;
        gap: 8px;
        padding: 8px 0;
        border-bottom: 2px solid var(--border);
        font-size: 12px;
        font-weight: 600;
        color: var(--fg-3);
        text-transform: uppercase;
    }

    &__row {
        display: flex;
        gap: 8px;
        padding: 8px 0;
        border-bottom: 1px solid var(--border);
        align-items: center;

        &:last-child { border-bottom: none; }
    }

    &__col {
        min-width: 60px;
        font-size: 13px;
        color: var(--fg-1);

        &--grow { flex: 1; }
    }

    &__status {
        display: inline-block;
        padding: 2px 8px;
        border-radius: 10px;
        font-size: 12px;

        &--complete, &--answersaved {
            background: rgba(46, 125, 50, 0.12);
            color: var(--status-submitted);
        }
        &--notyetanswered, &--todo {
            background: rgba(237, 108, 2, 0.1);
            color: var(--status-draft);
        }
        &--invalidanswer {
            background: rgba(211, 47, 47, 0.1);
            color: var(--status-overdue);
        }
    }

    &__actions {
        display: flex;
        gap: 8px;
        justify-content: flex-end;
    }
}

/* Review */
.quiz-review-grade {
    padding: 20px 24px;

    &__value {
        font-size: 22px;
        font-weight: 700;
        color: var(--grade-text, var(--accent));
        display: block;
        margin-bottom: 8px;
    }

    &__info {
        font-size: 13px;
        color: var(--fg-2);
        margin-top: 6px;

        strong { color: var(--fg-1); margin-right: 4px; }
    }
}

.quiz-review-question {
    padding: 16px 20px;
    border-left: 4px solid var(--border);

    &--correct, &--complete {
        border-left-color: var(--status-submitted);
    }
    &--incorrect, &--notanswered {
        border-left-color: var(--status-overdue);
    }
    &--partiallycorrect {
        border-left-color: var(--status-draft);
    }

    &__header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 10px;
    }

    &__number {
        font-size: 14px;
        font-weight: 600;
        color: var(--fg-1);
    }

    &__status {
        font-size: 12px;
        font-weight: 500;
        color: var(--fg-3);
    }

    &__body {
        font-size: 14px;
        line-height: 1.6;
        color: var(--fg-2);

        // ── Unsupported question type notice ──
        ::ng-deep .unsupported-qtype-notice {
            padding: 10px 14px;
            margin-bottom: 12px;
            border-radius: 6px;
            background: rgba(237, 108, 2, 0.1);
            border: 1px solid rgba(237, 108, 2, 0.25);
            color: var(--fg-2);
            font-size: 13px;
        }

        // ── Question info line (points, state, flag) ──
        ::ng-deep .info {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            gap: 8px;
            margin-bottom: 10px;
            font-size: 12px;
            color: var(--fg-3);

            .questionflag {
                display: inline-flex;
                align-items: center;

                input[type="image"],
                img {
                    width: 16px !important;
                    height: 16px !important;
                    vertical-align: middle;
                    opacity: 0.5;
                }

                .questionflagtext { display: none; }
            }

            .state {
                font-size: 12px;
                font-weight: 500;
                padding: 2px 8px;
                border-radius: 10px;
                background: var(--bg-2);
            }
        }

        // ── Question formulation ──
        ::ng-deep .formulation {
            padding: 12px 14px;
            border-radius: 8px;
            background: var(--bg-2);
            margin-bottom: 12px;
        }

        ::ng-deep .qtext {
            font-weight: 500;
            color: var(--fg-1);
            margin-bottom: 10px;

            p { margin: 4px 0; }
        }

        ::ng-deep .ablock {
            margin-top: 8px;
        }

        // ── Answer options ──
        ::ng-deep .answer {
            display: flex;
            flex-direction: column;
            gap: 6px;

            > div {
                display: flex;
                align-items: flex-start;
                gap: 8px;
                padding: 6px 10px;
                border-radius: 6px;

                &.correct { background: rgba(46, 125, 50, 0.08); }
                &.incorrect { background: rgba(211, 47, 47, 0.06); }
            }

            label {
                display: flex;
                align-items: flex-start;
                gap: 8px;
                flex: 1;
                min-width: 0;
            }
        }

        // ── Tables (matching questions) ──
        ::ng-deep table {
            width: 100%;
            border-collapse: collapse;
            margin: 8px 0;
            font-size: 14px;

            th, td {
                padding: 8px 12px;
                text-align: left;
                border-bottom: 1px solid var(--border);
                color: var(--fg-1);
            }

            th {
                font-weight: 600;
                font-size: 12px;
                text-transform: uppercase;
                color: var(--fg-3);
                background: var(--bg-2);
            }

            tr:last-child td { border-bottom: none; }
            tr.correct td { background: rgba(46, 125, 50, 0.06); }
            tr.incorrect td { background: rgba(211, 47, 47, 0.04); }
        }

        // ── Form controls (disabled in review) ──
        ::ng-deep input[type="radio"],
        ::ng-deep input[type="checkbox"] {
            accent-color: var(--accent);
            width: 16px;
            height: 16px;
            flex-shrink: 0;
            margin-top: 2px;
            pointer-events: none;
        }

        ::ng-deep input[type="text"],
        ::ng-deep textarea {
            padding: 6px 10px;
            border: 1px solid var(--border);
            border-radius: 6px;
            background: var(--bg-1);
            color: var(--fg-1);
            font-size: 14px;
            font-family: inherit;
            pointer-events: none;
            opacity: 0.85;
            max-width: 100%;
        }

        ::ng-deep select {
            appearance: auto;
            padding: 6px 10px;
            border: 1px solid var(--border);
            border-radius: 6px;
            background: var(--bg-1);
            color: var(--fg-1);
            font-size: 14px;
            font-family: inherit;
            pointer-events: none;
            opacity: 0.85;
            max-width: 280px;
        }

        // ── Correctness badges ──
        ::ng-deep .correct { color: var(--status-submitted); }
        ::ng-deep .incorrect { color: var(--status-overdue); }
        ::ng-deep .partiallycorrect { color: var(--status-draft); }

        ::ng-deep .correctness {
            display: inline-block;
            font-size: 12px;
            font-weight: 500;
            padding: 2px 8px;
            border-radius: 10px;
            margin-left: 6px;

            &.correct {
                background: rgba(46, 125, 50, 0.12);
                color: var(--status-submitted);
            }
            &.incorrect {
                background: rgba(211, 47, 47, 0.1);
                color: var(--status-overdue);
            }
            &.partiallycorrect {
                background: rgba(237, 108, 2, 0.1);
                color: var(--status-draft);
            }
        }

        // ── Feedback blocks ──
        ::ng-deep .feedback,
        ::ng-deep .specificfeedback {
            margin-top: 10px;
            padding: 10px 14px;
            border-radius: 6px;
            background: var(--bg-2);
            font-size: 13px;
        }

        ::ng-deep .generalfeedback {
            margin-top: 8px;
            padding: 10px 14px;
            border-radius: 6px;
            background: rgba(0, 120, 212, 0.06);
            font-size: 13px;
        }

        ::ng-deep .rightanswer {
            margin-top: 8px;
            padding: 10px 14px;
            border-radius: 6px;
            background: rgba(46, 125, 50, 0.06);
            font-size: 13px;
            color: var(--fg-2);
        }

        ::ng-deep .numpartscorrect {
            margin-top: 6px;
            font-size: 13px;
            color: var(--fg-3);
        }

        // ── Outcome block (wraps feedback + rightanswer) ──
        ::ng-deep .outcome {
            margin-top: 12px;
        }

        // ── Global flag image catch-all ──
        ::ng-deep .questionflagimage,
        ::ng-deep .questionflag input[type="image"],
        ::ng-deep .questionflag img {
            width: 16px !important;
            height: 16px !important;
            vertical-align: middle;
            opacity: 0.5;
            border-radius: 0 !important;
        }

        // ── Images ──
        ::ng-deep img {
            max-width: 100%;
            border-radius: 4px;
            height: auto;
        }

        // ── Hide screen-reader-only elements ──
        ::ng-deep .accesshide,
        ::ng-deep .sr-only {
            position: absolute !important;
            width: 1px !important;
            height: 1px !important;
            overflow: hidden !important;
            clip: rect(0, 0, 0, 0) !important;
            white-space: nowrap !important;
        }

        // Drag & drop placeholders
        ::ng-deep .draghome,
        ::ng-deep .droptarget,
        ::ng-deep .drop,
        ::ng-deep .place {
            display: inline-block;
            padding: 4px 10px;
            border: 1px dashed var(--border);
            border-radius: 4px;
            background: var(--bg-2);
            min-width: 60px;
            min-height: 28px;
            vertical-align: middle;
        }

        ::ng-deep .validationerror {
            color: var(--status-overdue);
            font-size: 13px;
            margin-top: 4px;
        }

        // Links
        ::ng-deep a {
            color: var(--accent);
            text-decoration: none;
            &:hover { text-decoration: underline; }
        }

        // Moodle submit buttons in review (shouldn't normally appear, but safety)
        ::ng-deep input[type="submit"],
        ::ng-deep button {
            display: inline-flex;
            align-items: center;
            padding: 6px 14px;
            border: 1px solid var(--border);
            border-radius: 6px;
            background: var(--bg-2);
            color: var(--fg-1);
            font-size: 13px;
            font-family: inherit;
            pointer-events: none;
            opacity: 0.7;
        }
    }
}

/* ============ Generic ============ */
.generic-view {
    padding: 24px;
}

.generic-content {
    font-size: 14px;
    line-height: 1.6;
    color: var(--fg-2);

    img { max-width: 100%; }
    a { color: var(--accent); }
}

.generic-files {
    h4 { margin: 0 0 8px; font-size: 14px; font-weight: 600; }
}

/* ============ Form Elements ============ */
.form-input {
    display: block;
    width: 100%;
    padding: 8px 12px;
    border: 1px solid var(--border);
    border-radius: 6px;
    background: var(--bg-1);
    color: var(--fg-1);
    font-size: 14px;
    font-family: inherit;
    outline: none;
    transition: border-color 120ms ease;
    box-sizing: border-box;

    &:focus {
        border-color: var(--accent);
    }
}

.form-textarea {
    resize: vertical;
    min-height: 60px;
}

/* ============================================================
   DD Question Types — shared styles for ddwtos, ddimageortext, ddmarker
   ============================================================ */

/* ── ddwtos (Drag Words onto Sentences) ── */
::ng-deep .que.ddwtos {
    .qtext {
        position: relative;

        span.drop {
            display: inline-block;
            border: 1px solid #999;
            border-radius: 3px;
            min-width: 40px;
            min-height: 20px;
            vertical-align: middle;
            background: rgba(255, 255, 255, 0.08);
            text-align: center;
        }
    }

    .answercontainer,
    .drags {
        position: relative;
        min-height: 30px;
    }

    .drags span.drag,
    .draghome {
        display: inline-block;
        padding: 2px 6px;
        margin: 2px;
        border: 1px solid #aaa;
        border-radius: 3px;
        background: var(--bg-2, #f0f0f0);
        color: var(--fg-1, #333);
        cursor: pointer;
        text-align: center;
        user-select: none;
        transition: box-shadow 120ms ease, transform 80ms ease;
        font-size: 13px;
        line-height: 1.4;
    }

    .draghome {
        visibility: hidden;
    }

    .drags span.drag.selected,
    .drags span.drag.beingdragged {
        box-shadow: 0 2px 8px rgba(0, 120, 215, 0.5);
        transform: scale(1.05);
        z-index: 10;
        outline: 2px solid var(--accent, #0078d4);
    }

    .drags span.drag.unplaced {
        opacity: 0.85;
    }

    /* Group colours */
    .group1 { background-color: rgba(255, 255, 255, 0.15); }
    .group2 { background-color: rgba(176, 196, 222, 0.25); }
    .group3 { background-color: rgba(220, 220, 220, 0.2); }
    .group4 { background-color: rgba(216, 191, 216, 0.25); }
    .group5 { background-color: rgba(135, 206, 250, 0.2); }
    .group6 { background-color: rgba(218, 165, 32, 0.2); }
    .group7 { background-color: rgba(255, 215, 0, 0.2); }
    .group8 { background-color: rgba(240, 230, 140, 0.2); }

    &.readonly {
        .drags span.drag { cursor: default; }
    }
}

/* ── ddimageortext (Drag Images/Text onto Image) ── */
::ng-deep .que.ddimageortext {
    .ddarea {
        position: relative;
        text-align: center;
        margin: 8px 0;
    }

    .dropbackground {
        display: block;
        max-width: 100%;
        height: auto;
        user-select: none;
    }

    .dragitems,
    .draghomes {
        position: relative;
        min-height: 40px;
        display: flex;
        flex-wrap: wrap;
        gap: 4px;
        padding: 6px 0;
    }

    .dragitems .drag,
    .draghome {
        display: inline-block;
        padding: 4px 8px;
        margin: 2px;
        border: 1px solid #888;
        border-radius: 4px;
        background: var(--bg-2, #f0f0f0);
        color: var(--fg-1, #333);
        cursor: pointer;
        user-select: none;
        font-size: 12px;
        z-index: 5;
        transition: box-shadow 120ms ease;
    }

    .draghome {
        visibility: hidden;
        position: absolute;
    }

    .dragplaceholder {
        visibility: hidden;
    }

    .dragitems .drag.beingdragged {
        box-shadow: 0 2px 8px rgba(0, 120, 215, 0.5);
        outline: 2px solid var(--accent, #0078d4);
        z-index: 20;
    }

    .dragitems .drag.placed {
        z-index: 8;
    }

    .dragitems .drag img {
        max-width: 120px;
        max-height: 80px;
        display: block;
    }

    .dropzones {
        position: absolute;
        top: 0;
        left: 0;
    }

    .dropzone {
        position: absolute;
        border: 2px dashed rgba(0, 0, 0, 0.3);
        border-radius: 4px;
        min-width: 32px;
        min-height: 24px;
        cursor: pointer;
        background: rgba(255, 255, 255, 0.15);
        transition: border-color 120ms ease;

        &:hover {
            border-color: var(--accent, #0078d4);
        }
    }

    /* Group colours for drop zones */
    .dropzone.group1 { background-color: rgba(255, 255, 255, 0.2); }
    .dropzone.group2 { background-color: rgba(176, 196, 222, 0.2); }
    .dropzone.group3 { background-color: rgba(220, 220, 220, 0.2); }
    .dropzone.group4 { background-color: rgba(216, 191, 216, 0.2); }

    &.readonly {
        .drag { cursor: default; }
        .dropzone { cursor: default; }
    }
}

/* ── ddmarker (Drag Markers onto Image) ── */
::ng-deep .que.ddmarker {
    .ddarea {
        position: relative;
        text-align: center;
        margin: 8px 0;
    }

    .dropbackground {
        display: block;
        max-width: 100%;
        height: auto;
        user-select: none;
        cursor: crosshair;
    }

    .draghomes,
    .dragitems {
        position: relative;
        min-height: 40px;
        display: flex;
        flex-wrap: wrap;
        gap: 4px;
        padding: 6px 0;
    }

    .draghome,
    .marker,
    .dragitem {
        display: inline-block;
        padding: 4px 10px;
        margin: 2px;
        border: 1px solid #888;
        border-radius: 12px;
        background: var(--bg-2, #f0f0f0);
        color: var(--fg-1, #333);
        cursor: pointer;
        user-select: none;
        font-size: 12px;
        z-index: 5;
        transition: box-shadow 120ms ease;
    }

    .dragplaceholder {
        visibility: hidden;
        position: absolute;
    }

    .dragitem.beingdragged {
        box-shadow: 0 2px 8px rgba(0, 120, 215, 0.5);
        outline: 2px solid var(--accent, #0078d4);
        z-index: 20;
    }

    .dragitem.placed {
        position: absolute;
        z-index: 8;
    }

    .dropzones {
        position: absolute;
        top: 0;
        left: 0;
        pointer-events: none;

        svg {
            position: absolute;
            top: 0;
            left: 0;
        }
    }

    .markertexts {
        position: absolute;
        top: 0;
        left: 0;
        pointer-events: none;

        .markertext {
            position: absolute;
            font-size: 11px;
            background: rgba(255, 255, 255, 0.75);
            padding: 1px 4px;
            border-radius: 2px;
            white-space: nowrap;
        }
    }

    &.readonly {
        .dropbackground { cursor: default; }
        .dragitem { cursor: default; }
    }
}

/* ── gapselect (inline select dropdowns) ── */
::ng-deep .que.gapselect {
    select {
        display: inline-block;
        padding: 2px 6px;
        border: 1px solid var(--border, #ccc);
        border-radius: 4px;
        background: var(--bg-2, #fff);
        color: var(--fg-1, #333);
        font-size: 13px;
        cursor: pointer;
        vertical-align: middle;
    }
}

/* ============ Buttons ============ */
.btn-primary {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 8px 16px;
    border: none;
    border-radius: 6px;
    background: var(--accent);
    color: #fff;
    font-size: 14px;
    font-weight: 500;
    cursor: pointer;
    transition: opacity 120ms ease;

    &:hover { opacity: 0.9; }
    &:disabled { opacity: 0.5; cursor: not-allowed; }
}

.btn-secondary {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 8px 16px;
    border: 1px solid var(--border);
    border-radius: 6px;
    background: var(--bg-2);
    color: var(--fg-1);
    font-size: 14px;
    font-weight: 500;
    cursor: pointer;
    transition: background 120ms ease;

    &:hover { background: var(--hover); }
    &:disabled { opacity: 0.5; cursor: not-allowed; }
}

.btn-subtle {
    display: inline-flex;
    align-items: center;
    gap: 4px;
    padding: 4px 8px;
    border: none;
    border-radius: 4px;
    background: transparent;
    color: var(--accent);
    font-size: 13px;
    cursor: pointer;

    &:hover { background: var(--hover); }
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(8px); }
    to { opacity: 1; transform: translateY(0); }
}
