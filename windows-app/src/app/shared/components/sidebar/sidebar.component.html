<nav class="sidebar" [class.sidebar--collapsed]="collapsed()">
    <!-- Toggle Button -->
    <button class="sidebar__toggle" (click)="toggleClick.emit()" aria-label="Toggle sidebar">
        <svg viewBox="0 0 20 20" width="20" height="20" fill="currentColor">
            <path
                d="M2 4.5A.5.5 0 012.5 4h15a.5.5 0 010 1h-15A.5.5 0 012 4.5zm0 5A.5.5 0 012.5 9h15a.5.5 0 010 1h-15A.5.5 0 012 9.5zm0 5a.5.5 0 01.5-.5h15a.5.5 0 010 1h-15a.5.5 0 01-.5-.5z" />
        </svg>
    </button>

    <!-- Navigation Items -->
    <div class="sidebar__nav scroll-area">
        @for (item of navItems; track item.route) {
        <a class="sidebar__item" [routerLink]="item.route" routerLinkActive="sidebar__item--active"
            [routerLinkActiveOptions]="{ exact: !!item.exact }" [title]="item.label">
            <span class="sidebar__item-indicator"></span>
            <span class="sidebar__item-icon">
                @switch (item.icon) {
                @case ('home') {
                <svg viewBox="0 0 20 20" width="20" height="20" fill="currentColor">
                    <path
                        d="M10.45 2.15a.75.75 0 00-.9 0l-6.75 5.25A.75.75 0 003 8.17V16a1 1 0 001 1h4.25a.75.75 0 00.75-.75v-4.5h2v4.5c0 .41.34.75.75.75H16a1 1 0 001-1V8.17a.75.75 0 00.2-.77l-6.75-5.25z" />
                </svg>
                }
                @case ('book') {
                <svg viewBox="0 0 20 20" width="20" height="20" fill="currentColor">
                    <path
                        d="M4 3a1 1 0 00-1 1v12a1 1 0 001 1h3.5a2.5 2.5 0 012.5 2.5.5.5 0 001 0A2.5 2.5 0 0113.5 17H16a1 1 0 001-1V4a1 1 0 00-1-1h-3.5A3.5 3.5 0 0010 4.67 3.5 3.5 0 007.5 3H4zm6.5 3.5A2.5 2.5 0 018 4H4.5v12h3A3.5 3.5 0 0110.5 17V6.5zm1 0V17a3.5 3.5 0 013-1H15.5V4H12a2.5 2.5 0 00-2.5 2.5z" />
                </svg>
                }
                @case ('search') {
                <svg viewBox="0 0 20 20" width="20" height="20" fill="currentColor">
                    <path
                        d="M8.5 3a5.5 5.5 0 014.38 8.82l3.65 3.65a.5.5 0 01-.7.7l-3.65-3.64A5.5 5.5 0 118.5 3zm0 1a4.5 4.5 0 100 9 4.5 4.5 0 000-9z" />
                </svg>
                }
                @case ('chat') {
                <svg viewBox="0 0 20 20" width="20" height="20" fill="currentColor">
                    <path d="M10 2a8 8 0 00-6.96 11.95L2.2 16.8a.75.75 0 00.95.94l2.91-.79A8 8 0 1010 2z" />
                </svg>
                }
                @case ('calendar') {
                <svg viewBox="0 0 20 20" width="20" height="20" fill="currentColor">
                    <path
                        d="M7 2.5a.5.5 0 00-1 0V3H4.5A1.5 1.5 0 003 4.5v11A1.5 1.5 0 004.5 17h11a1.5 1.5 0 001.5-1.5v-11A1.5 1.5 0 0015.5 3H14v-.5a.5.5 0 00-1 0V3H7v-.5zM4 7h12v8.5a.5.5 0 01-.5.5h-11a.5.5 0 01-.5-.5V7zm3 2a1 1 0 100 2 1 1 0 000-2zm3 0a1 1 0 100 2 1 1 0 000-2zm4 1a1 1 0 10-2 0 1 1 0 002 0zM7 12a1 1 0 100 2 1 1 0 000-2zm3 0a1 1 0 100 2 1 1 0 000-2z" />
                </svg>
                }
                @case ('bell') {
                <svg viewBox="0 0 20 20" width="20" height="20" fill="currentColor">
                    <path
                        d="M10 2a5 5 0 00-5 5v2.09a1 1 0 01-.2.6l-1.35 1.8A1 1 0 004.25 13h11.5a1 1 0 00.8-1.6l-1.36-1.82a1 1 0 01-.19-.58V7a5 5 0 00-5-5zm-1.5 14a1.5 1.5 0 003 0h-3z" />
                </svg>
                }
                @case ('folder') {
                <svg viewBox="0 0 20 20" width="20" height="20" fill="currentColor">
                    <path
                        d="M2 5.5A1.5 1.5 0 013.5 4h3.59a1.5 1.5 0 011.06.44L9.56 5.9a.5.5 0 00.35.15H16.5A1.5 1.5 0 0118 7.5v7a1.5 1.5 0 01-1.5 1.5h-13A1.5 1.5 0 012 14.5v-9z" />
                </svg>
                }
                @case ('grades') {
                <svg viewBox="0 0 20 20" width="20" height="20" fill="currentColor">
                    <path d="M4 2a2 2 0 00-2 2v12a2 2 0 002 2h12a2 2 0 002-2V4a2 2 0 00-2-2H4zm1 4h2v10H5V6zm4 3h2v7H9V9zm4-1h2v8h-2V8z" />
                </svg>
                }
                @case ('person') {
                <svg viewBox="0 0 20 20" width="20" height="20" fill="currentColor">
                    <path
                        d="M10 2a4 4 0 100 8 4 4 0 000-8zm-5.28 9A3.72 3.72 0 001 14.72V16a2 2 0 002 2h14a2 2 0 002-2v-1.28A3.72 3.72 0 0015.28 11H4.72z" />
                </svg>
                }
                @case ('settings') {
                <svg viewBox="0 0 20 20" width="20" height="20" fill="currentColor">
                    <path
                        d="M7.95 2.71a1.5 1.5 0 012.1 0l.71.7a1.5 1.5 0 001.42.37l.97-.26a1.5 1.5 0 011.83 1.06l.26.97a1.5 1.5 0 001.03 1.03l.97.26a1.5 1.5 0 011.06 1.83l-.26.97a1.5 1.5 0 00.37 1.42l.7.71a1.5 1.5 0 010 2.1l-.7.71a1.5 1.5 0 00-.37 1.42l.26.97a1.5 1.5 0 01-1.06 1.83l-.97.26a1.5 1.5 0 00-1.03 1.03l-.26.97a1.5 1.5 0 01-1.83 1.06l-.97-.26a1.5 1.5 0 00-1.42.37l-.71.7a1.5 1.5 0 01-2.1 0l-.71-.7a1.5 1.5 0 00-1.42-.37l-.97.26a1.5 1.5 0 01-1.83-1.06l-.26-.97a1.5 1.5 0 00-1.03-1.03l-.97-.26A1.5 1.5 0 01.7 14.33l.26-.97a1.5 1.5 0 00-.37-1.42l-.7-.71a1.5 1.5 0 010-2.1l.7-.71a1.5 1.5 0 00.37-1.42l-.26-.97A1.5 1.5 0 011.76 4.9l.97-.26a1.5 1.5 0 001.03-1.03l.26-.97a1.5 1.5 0 011.83-1.06l.97.26a1.5 1.5 0 001.42-.37l.71-.7zM10 13a3 3 0 100-6 3 3 0 000 6z" />
                </svg>
                }
                }
            </span>
            @if (!collapsed()) {
            <span class="sidebar__item-label">{{ item.label }}</span>
            }
            @if (getBadgeCount(item) > 0) {
            <span class="sidebar__item-badge" [class.sidebar__item-badge--dot]="collapsed()">
                @if (!collapsed()) {
                {{ getBadgeCount(item) }}
                }
            </span>
            }
        </a>
        }
    </div>

    <!-- Bottom Section -->
    <div class="sidebar__bottom">
        @for (item of bottomItems; track item.route) {
        <a class="sidebar__item" [routerLink]="item.route" routerLinkActive="sidebar__item--active" [title]="item.label">
            <span class="sidebar__item-indicator"></span>
            <span class="sidebar__item-icon">
                <svg viewBox="0 0 20 20" width="20" height="20" fill="currentColor">
                    <path
                        d="M7.95 2.71a1.5 1.5 0 012.1 0l.71.7a1.5 1.5 0 001.42.37l.97-.26a1.5 1.5 0 011.83 1.06l.26.97a1.5 1.5 0 001.03 1.03l.97.26a1.5 1.5 0 011.06 1.83l-.26.97a1.5 1.5 0 00.37 1.42l.7.71a1.5 1.5 0 010 2.1l-.7.71a1.5 1.5 0 00-.37 1.42l.26.97a1.5 1.5 0 01-1.06 1.83l-.97.26a1.5 1.5 0 00-1.03 1.03l-.26.97a1.5 1.5 0 01-1.83 1.06l-.97-.26a1.5 1.5 0 00-1.42.37l-.71.7a1.5 1.5 0 01-2.1 0l-.71-.7a1.5 1.5 0 00-1.42-.37l-.97.26a1.5 1.5 0 01-1.83-1.06l-.26-.97a1.5 1.5 0 00-1.03-1.03l-.97-.26A1.5 1.5 0 01.7 14.33l.26-.97a1.5 1.5 0 00-.37-1.42l-.7-.71a1.5 1.5 0 010-2.1l.7-.71a1.5 1.5 0 00.37-1.42l-.26-.97A1.5 1.5 0 011.76 4.9l.97-.26a1.5 1.5 0 001.03-1.03l.26-.97a1.5 1.5 0 011.83-1.06l.97.26a1.5 1.5 0 001.42-.37l.71-.7zM10 13a3 3 0 100-6 3 3 0 000 6z" />
                </svg>
            </span>
            @if (!collapsed()) {
            <span class="sidebar__item-label">{{ item.label }}</span>
            }
        </a>
        }

        <!-- Account Switcher Flyout -->
        @if (showAccountSwitcher() && !collapsed()) {
        <div class="account-flyout">
            <div class="account-flyout__header">
                <span class="account-flyout__title">Konten</span>
                <button class="account-flyout__close" (click)="toggleAccountSwitcher()" aria-label="Schliessen">
                    <svg viewBox="0 0 12 12" width="12" height="12" fill="currentColor">
                        <path
                            d="M1.35 1.35a.5.5 0 01.7 0L6 5.29l3.95-3.94a.5.5 0 01.7.7L6.71 6l3.94 3.95a.5.5 0 01-.7.7L6 6.71l-3.95 3.94a.5.5 0 01-.7-.7L5.29 6 1.35 2.05a.5.5 0 010-.7z" />
                    </svg>
                </button>
            </div>

            <!-- Current Account -->
            <div class="account-flyout__current">
                <span class="account-flyout__avatar account-flyout__avatar--active">
                    @if (userAvatar()) {
                    <img [src]="userAvatar()" [alt]="userFullName()" />
                    } @else {
                    <span class="account-flyout__initials">{{ userInitials() }}</span>
                    }
                </span>
                <div class="account-flyout__info">
                    <span class="account-flyout__name">{{ userFullName() }}</span>
                    <span class="account-flyout__site">Aktiv</span>
                </div>
                <svg class="account-flyout__check" viewBox="0 0 16 16" width="14" height="14" fill="currentColor">
                    <path
                        d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z" />
                </svg>
            </div>

            <!-- Other Accounts -->
            @for (account of otherAccounts(); track account.id) {
            <button class="account-flyout__account" (click)="onSwitchAccount(account)">
                <span class="account-flyout__avatar">
                    @if (account.userpictureurl) {
                    <img [src]="account.userpictureurl" [alt]="account.fullname" />
                    } @else {
                    <span class="account-flyout__initials">{{ getAccountInitials(account.fullname) }}</span>
                    }
                </span>
                <div class="account-flyout__info">
                    <span class="account-flyout__name">{{ account.fullname }}</span>
                    <span class="account-flyout__site">{{ account.sitename }}</span>
                </div>
                <button class="account-flyout__remove" (click)="onRemoveAccount($event, account.id)" title="Konto entfernen"
                    aria-label="Konto entfernen">
                    <svg viewBox="0 0 12 12" width="12" height="12" fill="currentColor">
                        <path
                            d="M1.35 1.35a.5.5 0 01.7 0L6 5.29l3.95-3.94a.5.5 0 01.7.7L6.71 6l3.94 3.95a.5.5 0 01-.7.7L6 6.71l-3.95 3.94a.5.5 0 01-.7-.7L5.29 6 1.35 2.05a.5.5 0 010-.7z" />
                    </svg>
                </button>
            </button>
            }

            <!-- Add Account -->
            <button class="account-flyout__add" (click)="onAddAccount()">
                <svg viewBox="0 0 20 20" width="16" height="16" fill="currentColor">
                    <path d="M10 2.5a.5.5 0 01.5.5v6.5H17a.5.5 0 010 1h-6.5V17a.5.5 0 01-1 0v-6.5H3a.5.5 0 010-1h6.5V3a.5.5 0 01.5-.5z" />
                </svg>
                <span>Konto hinzuf√ºgen</span>
            </button>

            <!-- Logout -->
            <button class="account-flyout__logout" (click)="logoutClick.emit(); showAccountSwitcher.set(false)">
                <svg viewBox="0 0 20 20" width="16" height="16" fill="currentColor">
                    <path
                        d="M3 4.5A1.5 1.5 0 014.5 3h5a.5.5 0 010 1h-5a.5.5 0 00-.5.5v11a.5.5 0 00.5.5h5a.5.5 0 010 1h-5A1.5 1.5 0 013 15.5v-11zm10.85 5.85a.5.5 0 000-.7l-3-3a.5.5 0 10-.7.7L12.29 9.5H7.5a.5.5 0 000 1h4.8l-2.15 2.15a.5.5 0 00.7.7l3-3z" />
                </svg>
                <span>Abmelden</span>
            </button>
        </div>
        }

        <!-- User Profile Button -->
        <button class="sidebar__user" (click)="collapsed() ? logoutClick.emit() : toggleAccountSwitcher()"
            [title]="collapsed() ? 'Abmelden' : 'Konten wechseln'">
            <span class="sidebar__user-avatar">
                @if (userAvatar()) {
                <img [src]="userAvatar()" [alt]="userFullName()" />
                } @else {
                <span class="sidebar__user-initials">{{ userInitials() }}</span>
                }
            </span>
            @if (!collapsed()) {
            <span class="sidebar__user-name">{{ userFullName() }}</span>
            <!-- Chevron up/down indicator -->
            <svg class="sidebar__user-chevron" [class.sidebar__user-chevron--open]="showAccountSwitcher()" viewBox="0 0 12 12" width="12"
                height="12" fill="currentColor">
                <path d="M2.15 4.65a.5.5 0 01.7 0L6 7.79l3.15-3.14a.5.5 0 11.7.7l-3.5 3.5a.5.5 0 01-.7 0l-3.5-3.5a.5.5 0 010-.7z" />
            </svg>
            }
        </button>
    </div>
</nav>
